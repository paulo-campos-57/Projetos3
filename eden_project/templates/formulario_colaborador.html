{% extends 'base.html' %}
{% load static %}
{% block content %}

<body>
    <!-- seu_template_cargo.html -->

    {% include 'partial/_navbar.html'%}

    <div class="formulario-user-imagem-contener">
        <img class="formulario-user-imagem" src="{% static 'assets/imagens/BarraPesquisa.png' %}" alt="{{ user.username }} Foto">
    </div>

    <div class="formulario-user-texto-nome">
        {{user.first_name}} {{user.last_name}}
    </div>

    <div class="formulario-texto-intrucao">
        Escreva sua motivação
        para tornar-se um colaborador
    </div>
    
    <form method="post" action="{% url 'formulario_colaborador' %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Salvar</button>
    </form>

    <select id="id_opcao" name="opcao">
        <option value="" selected disabled>Selecione uma opção</option>
        {% for opcao in opcoes %}
            <option value="{{ opcao.valor }}">{{ opcao.nome }}</option>
        {% endfor %}
    </select>

    <script>
        $(document).ready(function() {
            // Armazene a opção inicial para comparar com a opção selecionada antes de sair
            var opcaoInicial = $('#id_opcao').val();
    
            $('#id_opcao').change(function() {
                // Atualize a opção inicial sempre que houver uma mudança
                opcaoInicial = $(this).val();
            });
    
            $(window).on('beforeunload', function() {
                // Verifique se a opção foi alterada antes de sair da página
                if ($('#id_opcao').val() !== opcaoInicial) {
                    // Envie uma solicitação AJAX para a view Django
                    $.ajax({
                        url: '/atualizar_opcao/',  // Substitua pela URL correta
                        method: 'POST',
                        data: {'opcao_selecionada': $('#id_opcao').val()},
                        dataType: 'json',
                        async: false,  // Síncrono para garantir que a solicitação seja concluída antes de descarregar a página
                        success: function(data) {
                            // Lidar com a resposta, se necessário
                            console.log(data);
                        },
                        error: function(error) {
                            console.error(error);
                        }
                    });
                }
            });
        });
    </script>

</body>

{% endblock %}